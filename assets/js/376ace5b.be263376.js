"use strict";(self.webpackChunkcreate_project_docs=self.webpackChunkcreate_project_docs||[]).push([[5571],{23445:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>x,frontMatter:()=>r,metadata:()=>l,toc:()=>t});var d=n(74848),i=n(28453);const r={sidebar_position:2,description:"Backend API"},c="Backend API",l={id:"api-specification/Backend",title:"Backend API",description:"Backend API",source:"@site/docs/api-specification/Backend.md",sourceDirName:"api-specification",slug:"/api-specification/Backend",permalink:"/hippio/docs/api-specification/Backend",draft:!1,unlisted:!1,editUrl:"https://github.com/Civic-Interactions-Lab/hippio/edit/main/documentation/docs/api-specification/Backend.md",tags:[],version:"current",lastUpdatedBy:"Manan Patel",sidebarPosition:2,frontMatter:{sidebar_position:2,description:"Backend API"},sidebar:"docsSidebar",previous:{title:"Frontend API",permalink:"/hippio/docs/api-specification/Frontend"},next:{title:"Test Procedures",permalink:"/hippio/docs/category/test-procedures"}},o={},t=[{value:"Overview",id:"overview",level:2},{value:"Session and Player Lifecycle",id:"session-and-player-lifecycle",level:2},{value:"<code>CREATE_SESSION</code>",id:"create_session",level:3},{value:"<code>PLAYER_JOIN</code>",id:"player_join",level:3},{value:"WebSocket Communication",id:"websocket-communication",level:2},{value:"Client-to-Server Messages",id:"client-to-server-messages",level:3},{value:"Server \u2192 Client Broadcasts",id:"server--client-broadcasts",level:3},{value:"Error Handling and Edge Cases",id:"error-handling-and-edge-cases",level:2},{value:"Error Message Shape",id:"error-message-shape",level:3},{value:"Error Codes",id:"error-codes",level:3},{value:"Edge-Case Handling",id:"edge-case-handling",level:3},{value:"Utility Functions",id:"utility-functions",level:2},{value:"<code>generateSessionId(length = 5)</code>",id:"generatesessionidlength--5",level:3},{value:"<code>generateUniqueSessionId(existingSessions, length = 5)</code>",id:"generateuniquesessionidexistingsessions-length--5",level:3},{value:"<code>getWeightedRandomFood(allFoods, targetId)</code>",id:"getweightedrandomfoodallfoods-targetid",level:3},{value:"<code>broadcast(sessionId, data)</code>",id:"broadcastsessionid-data",level:3},{value:"Data Structures",id:"data-structures",level:2},{value:"<code>sessions: { [sessionId: string]: Set&lt;WebSocket&gt; }</code>",id:"sessions--sessionid-string-setwebsocket-",level:3},{value:"<code>scoresBySession: { [sessionId: string]: { [userId: string]: number } }</code>",id:"scoresbysession--sessionid-string--userid-string-number--",level:3},{value:"<code>activeFoods: { [sessionId: string]: FoodInstance[] }</code>",id:"activefoods--sessionid-string-foodinstance-",level:3},{value:"<code>fruitQueues: { [sessionId: string]: Food[] }</code>",id:"fruitqueues--sessionid-string-food-",level:3},{value:"<code>fruitIntervals: { [sessionId: string]: Interval }</code>",id:"fruitintervals--sessionid-string-interval-",level:3},{value:"Server Info",id:"server-info",level:2}];function h(e){const s={br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.h1,{id:"backend-api",children:"Backend API"}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,d.jsxs)(s.p,{children:["The backend is a ",(0,d.jsx)(s.strong,{children:"real-time multiplayer game server"})," implemented in ",(0,d.jsx)(s.strong,{children:"Node.js"})," using the ",(0,d.jsx)(s.code,{children:"ws"})," WebSocket library. It manages active game sessions, tracks scores and players, and arranges all real-time gameplay logic including spawning food, and effects."]}),"\n",(0,d.jsxs)(s.p,{children:["The server does ",(0,d.jsx)(s.strong,{children:"not"})," use REST endpoints. All communication is performed using WebSocket messages."]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Production"}),": Uses ",(0,d.jsx)(s.strong,{children:"PostgreSQL (via Railway)"})," to persist session/player data."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Local Development"}),": Uses a JSON file for session storage."]}),"\n"]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h2,{id:"session-and-player-lifecycle",children:"Session and Player Lifecycle"}),"\n",(0,d.jsx)(s.h3,{id:"create_session",children:(0,d.jsx)(s.code,{children:"CREATE_SESSION"})}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Purpose"}),": Generates a new unique ",(0,d.jsx)(s.code,{children:"sessionId"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Pre-conditions"}),": None."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Post-conditions"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Local: New entry added to ",(0,d.jsx)(s.code,{children:"sessionID.json"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:["Prod: New row inserted in ",(0,d.jsx)(s.code,{children:"sessions"})," table."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Returns"}),": ",(0,d.jsx)(s.code,{children:"{ sessionId: string }"})]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Example"}),": ",(0,d.jsx)(s.code,{children:'{ "ABCDE" }'})]}),"\n"]}),"\n",(0,d.jsx)(s.h3,{id:"player_join",children:(0,d.jsx)(s.code,{children:"PLAYER_JOIN"})}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Purpose"}),": Joins a user to a session and stores role/color."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Pre-conditions"}),": ",(0,d.jsx)(s.code,{children:"sessionId"})," must exist."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Post-conditions"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"Socket added to session\u2019s connection set."}),"\n",(0,d.jsx)(s.li,{children:"Broadcasts updated user list."}),"\n",(0,d.jsx)(s.li,{children:"Updates database if in production."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Returns"}),": Broadcasts ",(0,d.jsx)(s.code,{children:"PLAYER_JOINED_BROADCAST"})," and ",(0,d.jsx)(s.code,{children:"USERS_LIST_UPDATE"}),"."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Example"}),":","\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-js",children:'{\n  type: "PLAYER_JOIN",\n  payload: {\n    sessionId: "ABCDE",\n    userId: "User123",\n    role: "Hippo Player",\n    color: "blue"\n  }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h2,{id:"websocket-communication",children:"WebSocket Communication"}),"\n",(0,d.jsxs)(s.p,{children:["The server operates by receiving messages from clients and broadcasting ",(0,d.jsx)(s.strong,{children:"state updates"})," to all clients in a given session."]}),"\n",(0,d.jsx)(s.h3,{id:"client-to-server-messages",children:"Client-to-Server Messages"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Message Type"}),(0,d.jsx)(s.th,{children:"Payload Shape"}),(0,d.jsx)(s.th,{children:"Example (explicit keys)"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"CREATE_SESSION"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{}"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{}"})}),(0,d.jsx)(s.td,{children:"Requests a new unique session ID."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"VALIDATE_SESSION"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId: string }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE" }'})}),(0,d.jsx)(s.td,{children:"Validates session ID."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"PLAYER_JOIN"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, userId, role, color }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "userId": "User123", "role": "Hippo Player", "color": "blue" }'})}),(0,d.jsx)(s.td,{children:"Adds user to session and syncs presence."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"PLAYER_MOVE"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, userId, x, y }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "userId": "User123", "x": 100, "y": 200 }'})}),(0,d.jsx)(s.td,{children:"Sends current player position."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"AAC_FOOD_SELECTED"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, food, effect }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "food": "apple", "effect": null }'})}),(0,d.jsx)(s.td,{children:"Target food selection by AAC user."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"START_GAME"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, mode }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "mode": "Medium" }'})}),(0,d.jsx)(s.td,{children:"Initializes game loop and spawns food."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"START_TIMER"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE" }'})}),(0,d.jsx)(s.td,{children:"Starts countdown (180 s)."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"SET_EDGE"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, userId, edge }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "userId": "User123", "edge": "bottom" }'})}),(0,d.jsx)(s.td,{children:"Assigns spawn angle per player."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"FRUIT_EATEN"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, instanceId }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "instanceId": "food-12-User123" }'})}),(0,d.jsx)(s.td,{children:"Tells server to remove food from list."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"FRUIT_EATEN_BY_PLAYER"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, userId, isCorrect, effect }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "userId": "User123", "isCorrect": true, "effect": "grow" }'})}),(0,d.jsx)(s.td,{children:"Updates score and clears effect."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"PLAYER_EFFECT_APPLIED"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, targetUserId, effect }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "targetUserId": "User123", "effect": "freeze" }'})}),(0,d.jsx)(s.td,{children:"Triggers visual effect."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"SELECT_COLOR"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId, userId, color }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "userId": "User123", "color": "green" }'})}),(0,d.jsx)(s.td,{children:"Assigns a color to a user."})]})]})]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h3,{id:"server--client-broadcasts",children:"Server \u2192 Client Broadcasts"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Message Type"}),(0,d.jsx)(s.th,{children:"Payload Shape"}),(0,d.jsx)(s.th,{children:"Example (explicit keys)"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"SESSION_CREATED"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId: string }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE" }'})}),(0,d.jsx)(s.td,{children:"A new session was created."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"SESSION_VALIDATED"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ sessionId: string, isValid: boolean }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "sessionId": "ABCDE", "isValid": true }'})}),(0,d.jsx)(s.td,{children:"Result of a validation request."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"PLAYER_JOINED_BROADCAST"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ userId, role, color }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "userId": "User123", "role": "Hippo Player", "color": "blue" }'})}),(0,d.jsx)(s.td,{children:"Sent when a new player joins."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"USERS_LIST_UPDATE"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ users: [{ userId, role, color }] }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "users": [{ "userId": "User123", "role": "Hippo Player", "color": "blue" }, { "userId": "User456", "role": "AAC User", "color": "null" }] }'})}),(0,d.jsx)(s.td,{children:"Updated player list."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"FOOD_STATE_UPDATE"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ foods: [...] }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "foods": [{ "instanceId": "food-12-User123", "type": "apple", "x": 100, "y": 200 }] }'})}),(0,d.jsx)(s.td,{children:"Broadcasts food positions."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"AAC_TARGET_FOOD"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ targetFoodId, targetFoodData, effect }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "targetFoodId": "apple", "targetFoodData": { "type": "apple" }, "effect": null }'})}),(0,d.jsx)(s.td,{children:"Designates target food."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"SCORE_UPDATE_BROADCAST"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ scores: { [userId]: number } }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "scores": { "User123": 3, "User456": 1 } }'})}),(0,d.jsx)(s.td,{children:"Live score updates."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"REMOVE_FOOD"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ instanceId: string }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "instanceId": "food-12-User123" }'})}),(0,d.jsx)(s.td,{children:"Removes food from client canvas."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"PLAYER_EFFECT_BROADCAST"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ targetUserId, effect }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "targetUserId": "User456", "effect": "freeze" }'})}),(0,d.jsx)(s.td,{children:"Applies power-up or penalty effect."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"COLOR_UPDATE"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ takenColors: string[] }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "takenColors": ["blue", "red"] }'})}),(0,d.jsx)(s.td,{children:"Sends all chosen player colors."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"TIMER_UPDATE"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ secondsLeft: number }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "secondsLeft": 45 }'})}),(0,d.jsx)(s.td,{children:"Countdown timer for game end."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"GAME_OVER"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{}"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{}"})}),(0,d.jsx)(s.td,{children:"Signals game end state."})]})]})]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h2,{id:"error-handling-and-edge-cases",children:"Error Handling and Edge Cases"}),"\n",(0,d.jsx)(s.h3,{id:"error-message-shape",children:"Error Message Shape"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Message Type"}),(0,d.jsx)(s.th,{children:"Payload Shape"}),(0,d.jsx)(s.th,{children:"Example"})]})}),(0,d.jsx)(s.tbody,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ERROR_MESSAGE"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"{ code: string, message: string, [meta] }"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:'{ "code": "SESSION_NOT_FOUND", "message": "An error occured. Session ABCDE doesn\u2019t exist", "sessionId": "ABCDE" }'})})]})})]}),"\n",(0,d.jsx)(s.h3,{id:"error-codes",children:"Error Codes"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Code"}),(0,d.jsx)(s.th,{children:"Description"}),(0,d.jsx)(s.th,{children:"Trigger"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"SESSION_NOT_FOUND"})}),(0,d.jsx)(s.td,{children:"Session ID doesn\u2019t exist (file or DB)"}),(0,d.jsxs)(s.td,{children:[(0,d.jsx)(s.code,{children:"PLAYER_JOIN"}),", ",(0,d.jsx)(s.code,{children:"START_GAME"})]})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"SERVER_ERROR"})}),(0,d.jsx)(s.td,{children:"Any uncaught exception"}),(0,d.jsxs)(s.td,{children:["top-level ",(0,d.jsx)(s.code,{children:"try/catch"})]})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"edge-case-handling",children:"Edge-Case Handling"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.strong,{children:"Non-existent session"}),(0,d.jsx)(s.br,{}),"\n","Every handler validates ",(0,d.jsx)(s.code,{children:"sessionId"}),". If inactive, the server rejects the action and replies with ",(0,d.jsx)(s.code,{children:"SESSION_NOT_FOUND"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.strong,{children:"Duplicate player join"}),(0,d.jsx)(s.br,{}),"\n","Re-sending ",(0,d.jsx)(s.code,{children:"PLAYER_JOIN"})," for the same socket/user is harmless; the server ignores duplicates."]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.strong,{children:"Presenter disconnects before game start"})}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.em,{children:"Players still in lobby"}),": a 10s reconnect timer starts. If the presenter fails to return, the server broadcasts ",(0,d.jsx)(s.code,{children:"SESSION_CLOSED"})," and all clients navigate home."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.em,{children:"Lobby empty"}),": the session is removed from memory and database immediately."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.strong,{children:"AAC queue overflow"}),(0,d.jsx)(s.br,{}),"\n","When ",(0,d.jsx)(s.code,{children:"fruitQueues[sessionId]"})," already holds ",(0,d.jsx)(s.code,{children:"QUEUE_MAX"})," items, the oldest entry is dropped to make space. No error is sent."]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.strong,{children:"Game-timer expiry"}),(0,d.jsx)(s.br,{}),"\n","At 0s the server broadcasts ",(0,d.jsx)(s.code,{children:"GAME_OVER"}),", wipes active game state, and leaves session/player rows intact so the lobby can start another round. The session is deleted from the DB only after the last player disconnects."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h2,{id:"utility-functions",children:"Utility Functions"}),"\n",(0,d.jsx)(s.h3,{id:"generatesessionidlength--5",children:(0,d.jsx)(s.code,{children:"generateSessionId(length = 5)"})}),"\n",(0,d.jsx)(s.p,{children:"Generates a random alphanumeric session ID consisting of uppercase letters and digits."}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Parameters"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"length"})," (",(0,d.jsx)(s.code,{children:"number"}),") - Optional. Defaults to ",(0,d.jsx)(s.code,{children:"5"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Returns"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"string"})," - Random session ID."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Example"}),": ",(0,d.jsx)(s.code,{children:'{ "ABCDE" }'})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Pre-conditions"}),": None."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Post-conditions"}),": None."]}),"\n"]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h3,{id:"generateuniquesessionidexistingsessions-length--5",children:(0,d.jsx)(s.code,{children:"generateUniqueSessionId(existingSessions, length = 5)"})}),"\n",(0,d.jsx)(s.p,{children:"Ensures the session ID is not already in use."}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Parameters"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"existingSessions"})," (",(0,d.jsx)(s.code,{children:"string[]"}),")"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"length"})," (",(0,d.jsx)(s.code,{children:"number"}),") - Optional. Defaults to ",(0,d.jsx)(s.code,{children:"5"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Returns"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"string"})," - Unique session ID."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Example"}),": ",(0,d.jsx)(s.code,{children:'{ "ABCDE" }'})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Pre-conditions"}),": ",(0,d.jsx)(s.code,{children:"existingSessions"})," must be an array of valid IDs."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Post-conditions"}),": New ID guaranteed not in existingSessions."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Error handling"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Attempts up to ",(0,d.jsx)(s.strong,{children:"1000"})," random IDs.",(0,d.jsx)(s.br,{}),"\n","If no unique ID is found it throws ",(0,d.jsx)(s.strong,{children:(0,d.jsx)(s.code,{children:"Error: Max attempts reached"})})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h3,{id:"getweightedrandomfoodallfoods-targetid",children:(0,d.jsx)(s.code,{children:"getWeightedRandomFood(allFoods, targetId)"})}),"\n",(0,d.jsx)(s.p,{children:'Selects a food item randomly, with extra weight given to a "target" food ID.'}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Parameters"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"allFoods"})," (",(0,d.jsx)(s.code,{children:"object[]"}),") - Full list of food items."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"targetId"})," (",(0,d.jsx)(s.code,{children:"string"}),") - ID of the target food to favor."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Returns"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"object"})," - Randomly selected food object."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Example"}),": ",(0,d.jsx)(s.code,{children:'{ id: "apple", name: "Apple", imagePath: "/assets/fruits/apple.png" }'})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Pre-conditions"}),": ",(0,d.jsx)(s.code,{children:"allFoods"})," must include targetId."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Post-conditions"}),": Returns a new weighted choice each call."]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Error handling"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Logs ",(0,d.jsx)(s.em,{children:"\u201cFood list is empty or undefined\u201d"})," and returns ",(0,d.jsx)(s.strong,{children:(0,d.jsx)(s.code,{children:"null"})})," when ",(0,d.jsx)(s.code,{children:"allFoods"})," is empty / invalid."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h3,{id:"broadcastsessionid-data",children:(0,d.jsx)(s.code,{children:"broadcast(sessionId, data)"})}),"\n",(0,d.jsx)(s.p,{children:"Sends a message to all clients in a session."}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.strong,{children:"Parameters"}),":"]}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"sessionId"})," (",(0,d.jsx)(s.code,{children:"string"}),")"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"data"})," (",(0,d.jsx)(s.code,{children:"object"}),") - Will be serialized with ",(0,d.jsx)(s.code,{children:"JSON.stringify"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.strong,{children:"Pre-conditions"}),": ",(0,d.jsx)(s.code,{children:"sessions[sessionId]"})," must exist."]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.strong,{children:"Post-conditions"}),": All clients with ",(0,d.jsx)(s.code,{children:"readyState === OPEN"})," will receive the message."]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.strong,{children:"Error handling"})}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["If ",(0,d.jsx)(s.code,{children:"sessions[sessionId]"})," is missing, the function exits silently."]}),"\n",(0,d.jsxs)(s.li,{children:["Wraps each ",(0,d.jsx)(s.code,{children:"client.send()"})," in ",(0,d.jsx)(s.code,{children:"try / catch"}),"; on failure it logs"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:["\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.strong,{children:"Example"}),":"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-js",children:'broadcast("ABCDE", {\n  type: "SCORE_UPDATE_BROADCAST",\n  payload: { scores: { User123: 3, User456: 1 } }\n});\n\n\n'})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h2,{id:"data-structures",children:"Data Structures"}),"\n",(0,d.jsx)(s.h3,{id:"sessions--sessionid-string-setwebsocket-",children:(0,d.jsx)(s.code,{children:"sessions: { [sessionId: string]: Set<WebSocket> }"})}),"\n",(0,d.jsx)(s.p,{children:"Tracks all sockets connected to each active session."}),"\n",(0,d.jsx)(s.h3,{id:"scoresbysession--sessionid-string--userid-string-number--",children:(0,d.jsx)(s.code,{children:"scoresBySession: { [sessionId: string]: { [userId: string]: number } }"})}),"\n",(0,d.jsx)(s.p,{children:"Stores player scores per session."}),"\n",(0,d.jsx)(s.h3,{id:"activefoods--sessionid-string-foodinstance-",children:(0,d.jsx)(s.code,{children:"activeFoods: { [sessionId: string]: FoodInstance[] }"})}),"\n",(0,d.jsx)(s.p,{children:"Holds current active food objects on screen."}),"\n",(0,d.jsx)(s.h3,{id:"fruitqueues--sessionid-string-food-",children:(0,d.jsx)(s.code,{children:"fruitQueues: { [sessionId: string]: Food[] }"})}),"\n",(0,d.jsx)(s.p,{children:"FIFO queue of upcoming food to spawn."}),"\n",(0,d.jsx)(s.h3,{id:"fruitintervals--sessionid-string-interval-",children:(0,d.jsx)(s.code,{children:"fruitIntervals: { [sessionId: string]: Interval }"})}),"\n",(0,d.jsx)(s.p,{children:"Per-session loop interval that controls spawning and physics."}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h2,{id:"server-info",children:"Server Info"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Port"}),": ",(0,d.jsx)(s.code,{children:"4000"})," (local development)"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Protocol"}),": ",(0,d.jsx)(s.code,{children:"ws://"})," (WebSocket)"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Session Storage"}),":","\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:["Local: ",(0,d.jsx)(s.code,{children:"./src/data/sessionID.json"})]}),"\n",(0,d.jsxs)(s.li,{children:["Production: ",(0,d.jsx)(s.strong,{children:"PostgreSQL on Railway"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.strong,{children:"Frontend Deployment (Production)"}),":",(0,d.jsx)(s.br,{}),"\n","Hosted on Vercel - communicates with this WebSocket backend via ",(0,d.jsx)(s.code,{children:"wss://"})," in deployed mode."]}),"\n"]})]})}function x(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,d.jsx)(s,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>l});var d=n(96540);const i={},r=d.createContext(i);function c(e){const s=d.useContext(r);return d.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),d.createElement(r.Provider,{value:s},e.children)}}}]);